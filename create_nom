import sys
import pygame
import pymunk
import random

from pygame.locals import *
from pygame.color import *
from pymunk.util import *
from pymunk.vec2d import *

COLLTYPE_DEFAULT = 0
COLLTYPE_MOUSE = 1

class SwarmSim:

    '''
    Translates a point from pymunk to pygame
    '''
    def flipyv(self, v):
        return int(v.x), int(-v.y + self.h)

    def __init__(self):
        self.running = True

        pygame.init()
        self.w, self.h = 600,600
        self.screen = pygame.display.set_mode((self.w, self.h))
        self.clock = pygame.time.Clock()

        self.space = pymunk.Space()

        ### Walls
        self.walls = []

        ### Create Noms
        self.noms = []
        nomPos = [(355.0, 15.0), (255.0, 200.0), (15.0, 35.0)]

        for nom in nomPos:
            self.noms.append(self.create_nom(nomPos))

    def draw_nom(self, nom):
        body = nom.body
        color = THECOLORS["blue"]
        pos = self.flipyv(body.position)
        rad = nom.radius
        pygame.draw.circle(self.screen, color, pos, int(rad), 2)


    def create_nom(self, point, mass=1.0, radius=1.0):
        moment = pymunk.moment_for_circle(mass, radius, 0.0, (0,0))
        nom_body = pymunk.Body(mass, moment)
        nom_body.position = Vec2d(point)

        nom_shape = pymunk.Circle(nom_body, radius, Vec2d(0,0))
        nom_shape.friction = 100.0
        nom_shape.collision_type = COLLTYPE_DEFAULT
        self.space.add(nom_body, nom_shape)
        return nom_shape

    def draw(self):
        self.screen.fill(THECOLORS["white"])

        ### Draw noms
        for nom in self.noms:
            self.draw_nom(nom)

    def loop(self):
        for event in pygame.event.get():
            if event.type == QUIT:
                self.running = False
            elif event.type == KEYDOWN and event.key == K_ESCAPE:
                self.running = False

        self.draw()

        self.screen.fill(THECOLORS["white"])
        pygame.display.flip()
        self.clock.tick(50)

    def run(self):
        while self.running:
            self.loop()

def main():
    swarmSim = SwarmSim()
    swarmSim.run()

if __name__ == '__main__':
    sys.exit(main())
